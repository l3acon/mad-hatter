---
- name: Build Azure resources
  ansible.builtin.include_tasks: azure.yml

- name: Do rootful things (this is so ugly)
  ansible.builtin.include_tasks: podman.yml
  run_once: true
  args:
    apply:
      become: true
      delegate_to: clab

- name: Deploy containers (this is so ugly)
  ansible.builtin.include_tasks: config.yml
  run_once: true
  args:
    apply:
      become: true
      delegate_to: clab

- name: Capture CasC vars for out deployment method
  ansible.builtin.include_vars:
    file: "{{ clab_topology_deployment }}.yml"

- name: Build config as code for AAP
  ansible.builtin.include_role:
    name: infra.aap_configuration.dispatch
